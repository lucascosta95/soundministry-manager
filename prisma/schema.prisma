generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String   @id @default(cuid())
  email            String   @unique
  password         String
  name             String
  role             String   @default("USER")
  preferredTheme   String   @default("system")
  preferredLocale  String   @default("pt-BR")
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@map("users")
}

model SoundOperator {
  id                      String   @id @default(cuid())
  name                    String
  birthday                DateTime
  monthlyAvailability     Int
  weeklyAvailability      String[]
  annualAvailability      String[]
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  pairsAsFirst            PreferredPair[] @relation("FirstOperator")
  pairsAsSecond           PreferredPair[] @relation("SecondOperator")
  monthlyRestrictions     MonthlyRestriction[]

  @@map("sound_operators")
}

model PreferredPair {
  id              String   @id @default(cuid())
  firstOperatorId String
  secondOperatorId String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  firstOperator   SoundOperator @relation("FirstOperator", fields: [firstOperatorId], references: [id], onDelete: Cascade)
  secondOperator  SoundOperator @relation("SecondOperator", fields: [secondOperatorId], references: [id], onDelete: Cascade)

  @@unique([firstOperatorId, secondOperatorId])
  @@map("preferred_pairs")
}

model MonthlyRestriction {
  id              String   @id @default(cuid())
  operatorId      String
  month           Int
  year            Int
  restrictedDays  Int[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  operator        SoundOperator @relation(fields: [operatorId], references: [id], onDelete: Cascade)

  @@unique([operatorId, month, year])
  @@map("monthly_restrictions")
}
